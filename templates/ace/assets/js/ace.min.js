jQuery(function ($) {
    handle_side_menu();
    enable_search_ahead();
    general_things();
    widget_boxes()
});

function handle_side_menu() {
    jQuery("#menu-toggler").on(ace.click_event, function () {    	
        jQuery("#sidebar").toggleClass("display");            
        jQuery(this).toggleClass("display");
        return false
    });
    var b = jQuery("#sidebar").hasClass("menu-min");
    var cookie = jQuery.cookie('cookie_menu-min');

    if(typeof cookie == "undefined"){
    	jQuery.cookie('cookie_menu-min', b, { expires: 365 });
    }else{
        if(cookie === "true"){
        	b = true;
        }else{
        	b = false;
        }
    }   
    //console.log(b==true);
    if (b===true) {    	
        jQuery("#sidebar").addClass("menu-min");
        jQuery("#sidebar-collapse").find('[class*="icon-"]:eq(0)').addClass("icon-double-angle-right");
        jQuery(".open > .submenu").removeClass("open");
    	//jQuery("#sidebar-collapse").trigger(ace.click_event);
        jQuery('#sidebar #module-left').hide();
        
    	
    }else{    	
        jQuery("#sidebar").removeClass("menu-min");
        jQuery("#sidebar-collapse").find('[class*="icon-"]:eq(0)').removeClass("icon-double-angle-right");
        jQuery(".open > .submenu").addClass("open");
        jQuery('#sidebar #module-left').show();
       
        //jQuery("#sidebar-collapse").trigger(ace.click_event);
    }
    jQuery("#sidebar-collapse").on(ace.click_event, function () {
    	//console.log(b);
        jQuery("#sidebar").toggleClass("menu-min");
        jQuery(this).find('[class*="icon-"]:eq(0)').toggleClass("icon-double-angle-right");
        b = jQuery("#sidebar").hasClass("menu-min");
        jQuery.cookie('cookie_menu-min', b);
        //console.log(b);
        if (b) {
            jQuery(".open > .submenu").removeClass("open");
            jQuery('#sidebar #module-left').hide();
           
        }else{
        	jQuery('#sidebar #module-left').show();
        	
        }
    });
    //jQuery("#sidebar-collapse").trigger(ace.click_event);
    var a = "ontouchend" in document;
    jQuery(".nav-list").on(ace.click_event, function (g) {
        var f = jQuery(g.target).closest("a");
        if (!f || f.length == 0) {
            return
        }
        if (!f.hasClass("dropdown-toggle")) {
            if (b && ace.click_event == "tap" && f.get(0).parentNode.parentNode == this) {
                var h = f.find(".menu-text").get(0);
                if (g.target != h && !jQuery.contains(h, g.target)) {
                    return false
                }
            }
            return
        }
        var d = f.next().get(0);
        if (!jQuery(d).is(":visible")) {
            var c = jQuery(d.parentNode).closest("ul");
            if (b && c.hasClass("nav-list")) {
                return
            }
            c.find("> .open > .submenu").each(function () {
                if (this != d && !jQuery(this.parentNode).hasClass("active")) {
                    jQuery(this).slideUp(200).parent().removeClass("open")
                }
            })
        } else {} if (b && jQuery(d.parentNode.parentNode).hasClass("nav-list")) {
            return false
        }
        jQuery(d).slideToggle(200).parent().toggleClass("open");
        return false
    })
}

function enable_search_ahead() {
    jQuery("#nav-search-input").typeahead({
        source: ["Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware", "Florida", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", "New Mexico", "New York", "North Dakota", "North Carolina", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming"],
        updater: function (a) {
            jQuery("#nav-search-input").focus();
            return a
        }
    })
}

function general_things() {
    jQuery('.ace-nav [class*="icon-animated-"]').closest("a").on("click", function () {
        var b = jQuery(this).find('[class*="icon-animated-"]').eq(0);
        var a = b.attr("class").match(/icon\-animated\-([\d\w]+)/);
        b.removeClass(a[0]);
        jQuery(this).off("click")
    });
    jQuery(".nav-list .badge[title],.nav-list .label[title]").tooltip({
        placement: "right"
    });
    jQuery("#ace-settings-btn").on(ace.click_event, function () {
        jQuery(this).toggleClass("open");
        jQuery("#ace-settings-box").toggleClass("open")
    });
    jQuery("#ace-settings-header").removeAttr("checked").on("click", function () {
        if (!this.checked) {
            if (jQuery("#ace-settings-sidebar").get(0).checked) {
                jQuery("#ace-settings-sidebar").click()
            }
        }
        jQuery(".navbar").toggleClass("navbar-fixed-top");
        jQuery(document.body).toggleClass("navbar-fixed")
    });
    jQuery("#ace-settings-sidebar").removeAttr("checked").on("click", function () {
        if (this.checked) {
            if (!jQuery("#ace-settings-header").get(0).checked) {
                jQuery("#ace-settings-header").click()
            }
        } else {
            if (jQuery("#ace-settings-breadcrumbs").get(0).checked) {
                jQuery("#ace-settings-breadcrumbs").click()
            }
        }
        jQuery("#sidebar").toggleClass("fixed")
    });
    jQuery("#ace-settings-breadcrumbs").removeAttr("checked").on("click", function () {
        if (this.checked) {
            if (!jQuery("#ace-settings-sidebar").get(0).checked) {
                jQuery("#ace-settings-sidebar").click()
            }
        }
        jQuery("#breadcrumbs").toggleClass("fixed");
        jQuery(document.body).toggleClass("breadcrumbs-fixed")
    });
    jQuery("#ace-settings-rtl").removeAttr("checked").on("click", function () {
        switch_direction()
    });
    jQuery("#btn-scroll-up").on(ace.click_event, function () {
        var a = Math.max(100, parseInt(jQuery("html").scrollTop() / 3));
        jQuery("html,body").animate({
            scrollTop: 0
        }, a);
        return false
    });
    jQuery("#skin-colorpicker").ace_colorpicker().on("change", function () {
        var b = jQuery(this).find("option:selected").data("class");
        var a = jQuery(document.body);
        a.removeClass("skin-1 skin-2 skin-3");
        if (b != "default") {
            a.addClass(b)
        }
        if (b == "skin-1") {
            jQuery(".ace-nav > li.grey").addClass("dark")
        } else {
            jQuery(".ace-nav > li.grey").removeClass("dark")
        } if (b == "skin-2") {
            jQuery(".ace-nav > li").addClass("no-border margin-1");
            jQuery(".ace-nav > li:not(:last-child)").addClass("light-pink").find('> a > [class*="icon-"]').addClass("pink").end().eq(0).find(".badge").addClass("badge-warning")
        } else {
            jQuery(".ace-nav > li").removeClass("no-border margin-1");
            jQuery(".ace-nav > li:not(:last-child)").removeClass("light-pink").find('> a > [class*="icon-"]').removeClass("pink").end().eq(0).find(".badge").removeClass("badge-warning")
        } if (b == "skin-3") {
            jQuery(".ace-nav > li.grey").addClass("red").find(".badge").addClass("badge-yellow")
        } else {
            jQuery(".ace-nav > li.grey").removeClass("red").find(".badge").removeClass("badge-yellow")
        }
    })
}

function widget_boxes() {
    jQuery(".page-content").delegate(".widget-toolbar > [data-action]", "click", function (k) {
        k.preventDefault();
        var j = jQuery(this);
        var l = j.data("action");
        var a = j.closest(".widget-box");
        if (a.hasClass("ui-sortable-helper")) {
            return
        }
        if (l == "collapse") {
            var d = a.find(".widget-body");
            var i = j.find("[class*=icon-]").eq(0);
            var e = i.attr("class").match(/icon\-(.*)\-(up|down)/);
            var b = "icon-" + e[1] + "-down";
            var f = "icon-" + e[1] + "-up";
            var h = d.find(".widget-body-inner");
            if (h.length == 0) {
                d = d.wrapInner('<div class="widget-body-inner"></div>').find(":first-child").eq(0)
            } else {
                d = h.eq(0)
            }
            var c = 300;
            var g = 200;
            if (a.hasClass("collapsed")) {
                if (i) {
                    i.addClass(f).removeClass(b)
                }
                a.removeClass("collapsed");
                d.slideUp(0, function () {
                    d.slideDown(c)
                })
            } else {
                if (i) {
                    i.addClass(b).removeClass(f)
                }
                d.slideUp(g, function () {
                    a.addClass("collapsed")
                })
            }
        } else {
            if (l == "close") {
                var n = parseInt(j.data("close-speed")) || 300;
                a.hide(n, function () {
                    a.remove()
                })
            } else {
                if (l == "reload") {
                    j.blur();
                    var m = false;
                    if (a.css("position") == "static") {
                        m = true;
                        a.addClass("position-relative")
                    }
                    a.append('<div class="widget-box-layer"><i class="icon-spinner icon-spin icon-2x white"></i></div>');
                    setTimeout(function () {
                        a.find(".widget-box-layer").remove();
                        if (m) {
                            a.removeClass("position-relative")
                        }
                    }, parseInt(Math.random() * 1000 + 1000))
                } else {
                    if (l == "settings") {}
                }
            }
        }
    })
}

function switch_direction() {
    var c = jQuery(document.body);
    c.toggleClass("rtl").find(".dropdown-menu:not(.datepicker-dropdown,.colorpicker)").toggleClass("pull-right").end().find('.pull-right:not(.dropdown-menu,blockquote,.dropdown-submenu,.profile-skills .pull-right,.control-group .controls > [class*="span"]:first-child)').removeClass("pull-right").addClass("tmp-rtl-pull-right").end().find(".pull-left:not(.dropdown-submenu,.profile-skills .pull-left)").removeClass("pull-left").addClass("pull-right").end().find(".tmp-rtl-pull-right").removeClass("tmp-rtl-pull-right").addClass("pull-left").end().find(".chzn-container").toggleClass("chzn-rtl").end().find('.control-group .controls > [class*="span"]:first-child').toggleClass("pull-right").end();

    function a(g, f) {
        c.find("." + g).removeClass(g).addClass("tmp-rtl-" + g).end().find("." + f).removeClass(f).addClass(g).end().find(".tmp-rtl-" + g).removeClass("tmp-rtl-" + g).addClass(f)
    }

    function b(g, f, h) {
        h.each(function () {
            var j = jQuery(this);
            var i = j.css(f);
            j.css(f, j.css(g));
            j.css(g, i)
        })
    }
    a("align-left", "align-right");
    a("arrowed", "arrowed-right");
    a("arrowed-in", "arrowed-in-right");
    var d = jQuery("#piechart-placeholder");
    if (d.size() > 0) {
        var e = jQuery(document.body).hasClass("rtl") ? "nw" : "ne";
        d.data("draw").call(d.get(0), d, d.data("chart"), e)
    }
};